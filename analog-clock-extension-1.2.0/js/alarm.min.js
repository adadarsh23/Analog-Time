const hourSel=document.getElementById("alarmHour");const minuteSel=document.getElementById("alarmMinute");const ampmSel=document.getElementById("ampm");const setBtn=document.getElementById("setAlarm");const testBtn=document.getElementById("testSoundBtn");const soundSelect=document.getElementById("soundSelect");const alarmsList=document.getElementById("alarmsList");const oneTimeAlarm=document.getElementById("oneTimeAlarm");(function initTimePickers(){for(let h=1;h<=12;h++){const opt=document.createElement("option");opt.value=String(h);opt.textContent=String(h);hourSel.appendChild(opt)}for(let m=0;m<=59;m++){const opt=document.createElement("option");opt.value=String(m).padStart(2,"0");opt.textContent=String(m).padStart(2,"0");minuteSel.appendChild(opt)}hourSel.value="7";minuteSel.value="00";ampmSel.value="AM"})();function getSelectedDays(){return Array.from(document.querySelectorAll("#days input:checked")).map(cb=>parseInt(cb.value,10))}function to24h(hour12,minute,ampm){let h=parseInt(hour12,10)%12;if(ampm==="PM")h+=12;return{hours:h,minutes:parseInt(minute,10)}}function format12h(hours24,minutes){const period=hours24>=12?"PM":"AM";const h12=hours24%12||12;return`${String(h12).padStart(1,"0")}:${String(minutes).padStart(2,"0")} ${period}`}function displayAlarms(){chrome.alarms.getAll(alarms=>{if(!alarms.length){alarmsList.innerHTML="No alarms set";return}alarmsList.innerHTML="";alarms.forEach(alarm=>{const when=new Date(alarm.scheduledTime);const h=when.getHours();const m=when.getMinutes();const row=document.createElement("div");row.style.margin="8px 0";row.style.padding="8px";row.style.border="1px solid #ddd";row.style.borderRadius="8px";const title=document.createElement("div");title.innerHTML=`<strong>${format12h(h,m)} • ${when.toLocaleDateString()}</strong>`;row.appendChild(title);chrome.storage.local.get(`alarm_${alarm.name}`,data=>{const info=data[`alarm_${alarm.name}`];const meta=document.createElement("div");meta.style.fontSize="12px";meta.style.color="#666";if(info){const days=(info.repeatDays||[]).map(d=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d]).join(", ");meta.textContent=(info.repeatDays?.length?`Repeats: ${days} • `:"One-time • ")+`Sound: ${info.sound||"default"}`}else{meta.textContent="One-time"}row.appendChild(meta)});const btn=document.createElement("button");btn.textContent="Cancel";btn.style.marginTop="6px";btn.addEventListener("click",()=>{chrome.runtime.sendMessage({action:"cancelAlarm",alarmName:alarm.name},res=>{if(res?.success){displayAlarms()}else{alert("Failed to cancel alarm")}})});row.appendChild(btn);alarmsList.appendChild(row)})})}setBtn.addEventListener("click",()=>{const hour12=hourSel.value;const minute=minuteSel.value;const ampm=ampmSel.value;const{hours:hours,minutes:minutes}=to24h(hour12,minute,ampm);const repeatDays=getSelectedDays();const sound=soundSelect.value;const now=new Date;let alarmTime=new Date;alarmTime.setSeconds(0,0);if(repeatDays.length){const today=now.getDay();let next=null;for(let i=0;i<7;i++){const candidateDay=(today+i)%7;if(repeatDays.includes(candidateDay)){const candidate=new Date(now);candidate.setDate(now.getDate()+i);candidate.setHours(hours,minutes,0,0);if(candidate>now){next=candidate;break}}}if(!next){const daysAway=Math.min(...repeatDays.map(d=>(d-today+7)%7));next=new Date(now);next.setDate(now.getDate()+daysAway);next.setHours(hours,minutes,0,0)}alarmTime=next}else{alarmTime.setHours(hours,minutes,0,0);if(alarmTime<=now)alarmTime.setDate(alarmTime.getDate()+1)}const alarmName=`alarm_${Date.now()}`;chrome.alarms.create(alarmName,{when:alarmTime.getTime()});const alarmData={hours:hours,minutes:minutes,repeatDays:repeatDays,sound:sound,nextTrigger:alarmTime.getTime()};chrome.storage.local.set({[`alarm_${alarmName}`]:alarmData,alarmSound:sound});const whenLabel=format12h(hours,minutes);alert(repeatDays.length?`Recurring alarm set at ${whenLabel} on ${repeatDays.map(d=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d]).join(", ")}`:`One-time alarm set at ${whenLabel}`);displayAlarms()});function playSound(soundFile,ms=3e3,repeatCount=1){let played=0;function playOnce(){const audio=new Audio(chrome.runtime.getURL(`sounds/${soundFile}`));audio.play();setTimeout(()=>{audio.pause();audio.currentTime=0;played++;if(played<repeatCount){playOnce()}},ms)}playOnce()}testBtn.addEventListener("click",()=>{playSound(soundSelect.value,3e3)});chrome.storage.local.get("alarmSound",data=>{if(data.alarmSound)soundSelect.value=data.alarmSound});displayAlarms();chrome.runtime.onMessage.addListener((msg,sender,sendResponse)=>{if(msg.action==="playSound"&&msg.sound){playSound(msg.sound,3e3,msg.repeatCount||1)}});
//# sourceMappingURL=js/alarm.js.map